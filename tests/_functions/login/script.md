# Function: login - Detailed Script

> **Status**: Verified with Playwright MCP
> **Last Updated**: 2026-01-21
> **Generated By**: Cursor AI exploration with Playwright MCP

## Parameters
| Name | Type | Required | Description |
|------|------|----------|-------------|
| username | string | Yes | Email address for login |
| password | string | Yes | Account password |

## Initial State
- URL: Any (will navigate to login page)

## Actions

### Step 1: Navigate to Login Page
- **Action**: Navigate
- **Target**: https://www.vcita.com/login
- **Wait for**: Page to load (networkidle)
- **Note**: Cloudflare security check may appear

### Step 2: Handle Cloudflare (if present)
- **Action**: Wait
- **Condition**: Page title changes from "Just a moment..." to actual title
- **Timeout**: 60 seconds
- **Note**: This is automatic, but may require manual CAPTCHA solving

### Step 3: Access Login Form in Iframe
- **Action**: Locate iframe
- **Target**: `#vue_iframe`
- **Element hints**:
  - `page.locator('#vue_iframe').content_frame()`
- **Wait for**: Iframe to be present

### Step 4: Enter Email
- **Action**: Type
- **Target**: Email textbox inside iframe
- **Element hints**:
  - `iframe.get_by_role("textbox", name="Email")`
- **Value**: {username}

### Step 5: Enter Password
- **Action**: Type
- **Target**: Password textbox inside iframe
- **Element hints**:
  - `iframe.get_by_role("textbox", name="Password")`
- **Value**: {password}

### Step 6: Click Login Button
- **Action**: Click
- **Target**: "Log In" button inside iframe
- **Element hints**:
  - `iframe.get_by_role("button", name="Log In")`
- **Note**: Button text is "Log In" (with space), not "Login"

### Step 7: Wait for Dashboard
- **Action**: Wait for URL
- **Pattern**: `**/app/dashboard**`
- **Timeout**: 30 seconds
- **Note**: reCAPTCHA may appear and require manual solving

## Success Verification
- URL contains `/app/dashboard`
- Page title contains "Dashboard"

## Context Operations
After successful login:
```python
context["logged_in_user"] = username
```

## Page Structure Notes

The login page uses a nested structure:
```
Main page (www.vcita.com/login)
└── iframe#vue_iframe
    └── Login form
        ├── "Log In to Your Account" heading
        ├── Tab: "With password" (selected)
        ├── Tab: "With login code"
        ├── Email textbox
        ├── Password textbox
        ├── "Forgot password?" link
        ├── reCAPTCHA iframe (may not block)
        └── "Log In" button
```

## Troubleshooting

### Cloudflare Security Check
- Appears as "Just a moment..." page title
- Usually resolves automatically in 3-5 seconds
- If stuck, may need manual CAPTCHA solving

### reCAPTCHA
- May appear after clicking "Log In"
- Usually shows image selection challenge
- Requires manual solving in test environment

### Already Logged In
- If URL contains "dashboard", function returns immediately
- No need to re-login
