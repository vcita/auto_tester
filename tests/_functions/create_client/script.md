# Create Client Function - Detailed Script

> **Status**: Adapted from tests/clients/create_matter/test.py
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI - reusing verified code from create_matter test

## Parameters

- **first_name** (optional): First name of the client
- **last_name** (optional): Last name of the client
- **email** (optional): Email address

## Initial State

- User is logged in
- Browser can be on any page

## Actions

### Step 1: Navigate to Dashboard

- **Action**: Navigate
- **Target**: Dashboard page

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
page.goto("https://app.vcita.com/app/dashboard")
page.wait_for_load_state("domcontentloaded")
```

- **How verified**: Verified in create_matter test
- **Wait for**: DOM content loaded

### Step 2: Wait for Quick Actions Panel

- **Action**: Wait
- **Target**: "Quick actions" text on dashboard

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
page.get_by_text("Quick actions", exact=True).wait_for(state="visible", timeout=15000)
page.wait_for_timeout(3000)  # Wait for panel content to fully render
```

- **How verified**: Verified in create_matter test
- **Wait for**: Quick actions panel visible

### Step 3: Click Add Property

- **Action**: Click
- **Target**: "Add property" link in Quick actions

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
add_property_text = page.get_by_text("Add property", exact=True)
add_property_text.wait_for(state="visible", timeout=10000)
add_property_text.scroll_into_view_if_needed()
page.wait_for_timeout(500)
add_property_text.click()
```

- **How verified**: Verified in create_matter test
- **Wait for**: Form opens in iframe

### Step 4: Find Form Frame

- **Action**: Locate
- **Target**: Form iframe containing "First Name" field

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
form_frame = None
max_attempts = 10
for attempt in range(max_attempts):
    page.wait_for_timeout(500)
    for frame in page.frames:
        try:
            if frame.locator('text=First Name').count() > 0:
                form_frame = frame
                break
        except:
            pass
    if form_frame:
        break

if not form_frame:
    raise Exception("Could not find form frame with 'First Name' field")

form_frame.locator('text=First Name').wait_for(timeout=15000)
```

- **How verified**: Verified in create_matter test
- **Wait for**: First Name field visible

### Step 5: Fill First Name (Required)

- **Action**: Type
- **Target**: First Name field
- **Value**: `{first_name}`

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
first_name_field = form_frame.get_by_role("textbox", name="First Name *")
first_name_field.click()
first_name_field.press_sequentially(first_name, delay=50)
```

- **How verified**: Verified in create_matter test

### Step 6: Fill Last Name

- **Action**: Type
- **Target**: Last Name field
- **Value**: `{last_name}`

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
last_name_field = form_frame.get_by_role("textbox", name="Last Name")
last_name_field.click()
last_name_field.press_sequentially(last_name, delay=50)
```

- **How verified**: Verified in create_matter test

### Step 7: Fill Email

- **Action**: Type
- **Target**: Email field (becomes combobox when focused)
- **Value**: `{email}`

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
email_field = form_frame.get_by_role("textbox", name="Email")
email_field.click()
page.wait_for_timeout(100)  # Wait for field transformation
form_frame.get_by_role("combobox", name="Email").press_sequentially(email, delay=30)
```

- **How verified**: Verified in create_matter test

### Step 8: Click Save

- **Action**: Click
- **Target**: Save button

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
save_btn = form_frame.get_by_role("button", name="Save")
save_btn.click()
page.wait_for_url(re.compile(r"/app/clients/"), timeout=15000)
```

- **How verified**: Verified in create_matter test
- **Wait for**: URL changes to client page

### Step 9: Extract Client ID

- **Action**: Extract
- **Target**: Client ID from URL

**VERIFIED PLAYWRIGHT CODE** (from create_matter test):
```python
url = page.url
client_id_match = re.search(r'/app/clients/([^/]+)', url)
client_id = client_id_match.group(1) if client_id_match else None
```

- **How verified**: Verified in create_matter test
- **Save to context**: `created_client_id`, `created_client_name`, `created_client_email`

## Success Verification

- URL contains client ID
- Context contains client information
