# View Appointment Test - Detailed Script

> **Status**: Generated from exploration
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI exploration with Playwright MCP

## Initial State

- User is logged in
- An appointment exists (from create_appointment test)
- Context has: `created_appointment_client`, `created_appointment_service`
- Browser is on Calendar page (from previous test)

## Actions

### Step 1: Verify on Calendar Page

- **Action**: Verify/Navigate
- **Target**: URL contains "/app/calendar"

**VERIFIED PLAYWRIGHT CODE**:
```python
if "/app/calendar" not in page.url:
    calendar_menu = page.get_by_text("Calendar", exact=True)
    calendar_menu.click()
    page.wait_for_url("**/app/calendar**", timeout=10000)
```

- **How verified**: Verified in MCP
- **Wait for**: URL contains "/app/calendar"

### Step 2: Wait for Calendar to Load

- **Action**: Wait
- **Target**: Calendar iframe and grid with appointments

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_selector('iframe[title="angularjs"]', timeout=10000)
outer_iframe = page.frame_locator('iframe[title="angularjs"]')
inner_iframe = outer_iframe.frame_locator('#vue_iframe_layout')
# Wait for calendar grid to load
page.wait_for_timeout(2000)
```

- **How verified**: Verified in MCP
- **Wait for**: Calendar grid visible with appointments

### Step 3: Click on Appointment in Calendar

- **Action**: Click
- **Target**: Appointment menuitem containing the client name

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `inner_iframe.get_by_role('menuitem').filter(has_text=client_name)` | Dynamic, matches by client name | None |
| `inner_iframe.locator('[data-appointment-id]')` | Data attribute | Attribute may not exist |

**CHOSEN**: `inner_iframe.get_by_role('menuitem').filter(has_text=client_name)` - Matches appointment by client name.

**VERIFIED PLAYWRIGHT CODE**:
```python
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
appointment.click()
```

- **How verified**: Clicked in MCP, appointment details page opened
- **Wait for**: URL changes to `/app/appointments/{id}`

### Step 4: Wait for Appointment Details Page

- **Action**: Wait
- **Target**: Appointment details panel in outer iframe

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_url("**/app/appointments/**", timeout=10000)
# Wait for details panel to load
heading = outer_iframe.get_by_role('heading', name='Appointment')
heading.wait_for(state='visible', timeout=10000)
```

- **How verified**: Verified in MCP, heading appeared
- **Wait for**: "Appointment" heading visible

### Step 5: Verify Client Name

- **Action**: Verify
- **Target**: Client name in appointment details

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `outer_iframe.get_by_text(client_name)` | Simple text match | May match multiple |
| `outer_iframe.locator('[class*="client"]').filter(has_text=client_name)` | More specific | Class might change |

**CHOSEN**: `outer_iframe.get_by_text(client_name)` - Simple and effective for verification.

**VERIFIED PLAYWRIGHT CODE**:
```python
client_text = outer_iframe.get_by_text(client_name)
client_text.wait_for(state='visible', timeout=5000)
```

- **How verified**: Client name "Autotest" visible in MCP
- **Save to context**: None (verification only)

### Step 6: Verify Service Name

- **Action**: Verify
- **Target**: Service name in appointment details

**VERIFIED PLAYWRIGHT CODE**:
```python
service_heading = outer_iframe.get_by_role('heading', name=service_name)
service_heading.wait_for(state='visible', timeout=5000)
```

- **How verified**: Service name appeared as h3 heading in MCP
- **Save to context**: None (verification only)

### Step 7: Verify Date/Time Displayed

- **Action**: Verify
- **Target**: Date/time heading (e.g., "Fri, January 23, 3:00pm â€“ 3:30pm")

**VERIFIED PLAYWRIGHT CODE**:
```python
# The date/time appears in an h2 heading within the details
date_time_heading = outer_iframe.get_by_role('heading', level=2)
date_time_heading.wait_for(state='visible', timeout=5000)
```

- **How verified**: Date/time heading visible in MCP

### Step 8: Click Back to Return to Calendar

- **Action**: Click
- **Target**: "Back" link/button in header

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `page.locator('.backButtonSection')` | Direct CSS | Class might change |
| `page.get_by_text('Back')` | Text-based | None |

**CHOSEN**: `page.get_by_text('Back')` - Simple and reliable.

**VERIFIED PLAYWRIGHT CODE**:
```python
back_btn = page.get_by_text('Back')
back_btn.click()
page.wait_for_url("**/app/calendar**", timeout=10000)
```

- **How verified**: Clicked in MCP, returned to calendar
- **Wait for**: URL contains "/app/calendar"

## Success Verification

- Appointment details page opens with correct URL pattern
- Client name is visible and matches context
- Service name is visible and matches context
- Date/time is displayed
- Can return to calendar via Back button
