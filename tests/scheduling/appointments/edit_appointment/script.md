# Edit Appointment Test - Detailed Script

> **Status**: Generated from MCP exploration
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI exploration with Playwright MCP

## Initial State

- User is logged in
- An appointment exists (from create_appointment test)
- Context has: created_appointment_client, created_appointment_service
- Browser is on Calendar page

## Actions

### Step 1: Verify on Calendar Page

- **Action**: Verify
- **Target**: URL contains "/app/calendar"

**VERIFIED PLAYWRIGHT CODE**:
```python
if "/app/calendar" not in page.url:
    calendar_menu = page.get_by_text("Calendar", exact=True)
    calendar_menu.click()
    page.wait_for_url("**/app/calendar**", timeout=10000)
```

### Step 2: Wait for Calendar to Load

- **Action**: Wait
- **Target**: Calendar iframe and appointments

**VERIFIED PLAYWRIGHT CODE**:
```python
client_name = context.get("created_appointment_client")
page.wait_for_selector('iframe[title="angularjs"]', timeout=10000)
outer_iframe = page.frame_locator('iframe[title="angularjs"]')
inner_iframe = outer_iframe.frame_locator('#vue_iframe_layout')
# Wait for calendar to load (event-based: appointment visible)
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
```

### Step 3: Click on Appointment in Calendar

- **Action**: Click
- **Target**: Appointment menuitem with client name

**VERIFIED PLAYWRIGHT CODE**:
```python
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
appointment.click()
```

### Step 4: Wait for Appointment Details Page

- **Action**: Wait
- **Target**: Appointment details page loads

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_url("**/app/appointments/**", timeout=10000)
heading = outer_iframe.get_by_role('heading', name='Appointment').first
heading.wait_for(state='visible', timeout=10000)
```

### Step 5: Click Add Note Button

- **Action**: Click
- **Target**: "Add note" button in Internal note section

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `outer_iframe.get_by_role('button', name='Add note')` | Unique, semantic | None |

**CHOSEN**: `outer_iframe.get_by_role('button', name='Add note')` - Unique button.

**VERIFIED PLAYWRIGHT CODE**:
```python
add_note_btn = outer_iframe.get_by_role('button', name='Add note')
add_note_btn.wait_for(state='visible', timeout=5000)
add_note_btn.click()
# Wait for note dialog (event-based: note iframe and contenteditable)
note_iframe = outer_iframe.frame_locator('#vue_wizard_iframe')
note_area = note_iframe.locator('[contenteditable="true"]')
note_area.wait_for(state='visible', timeout=10000)
```

### Step 6: Enter Note Text

- **Action**: Type
- **Target**: Contenteditable note area in vue_wizard_iframe
- **Value**: Test note with timestamp

**VERIFIED PLAYWRIGHT CODE**:
```python
# The note modal opens in a nested iframe with id vue_wizard_iframe
note_iframe = outer_iframe.frame_locator('#vue_wizard_iframe')
note_area = note_iframe.locator('[contenteditable="true"]')
note_area.click()
page.wait_for_timeout(200)  # Brief settle for editor focus (allowed)
page.keyboard.type(test_note)
```

### Step 7: Save the Note

- **Action**: Click
- **Target**: "Save" button in note dialog

**VERIFIED PLAYWRIGHT CODE**:
```python
save_btn = note_iframe.get_by_role('button', name='Save')
save_btn.wait_for(state='visible', timeout=5000)
save_btn.click()
# Wait for save to complete (event-based: saved note visible)
saved_note = outer_iframe.get_by_role('button').filter(has_text=test_note)
saved_note.wait_for(state='visible', timeout=10000)
```

### Step 8: Verify Note Saved (Actual Data Verification)

- **Action**: Verify
- **Target**: Note text appears in appointment details

**VERIFIED PLAYWRIGHT CODE**:
```python
# The note should appear as a button with the note text in the Internal note section
saved_note = outer_iframe.get_by_role('button').filter(has_text=test_note)
saved_note.wait_for(state='visible', timeout=10000)
```

### Step 9: Return to Calendar

- **Action**: Click
- **Target**: "Back" link

**VERIFIED PLAYWRIGHT CODE**:
```python
back_btn = page.get_by_text('Back')
back_btn.click()
page.wait_for_url("**/app/calendar**", timeout=10000)
```

## Success Verification

- Note text is visible in the appointment details (actual data verification)
- DO NOT rely on toast messages
