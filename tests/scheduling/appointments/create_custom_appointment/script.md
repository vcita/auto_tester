# Create Custom Appointment Test - Detailed Script

> **Status**: Generated from MCP exploration
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI exploration with Playwright MCP

## Initial State

- User is logged in
- Test client exists (context: created_client_name)
- Browser is on Calendar page

## Actions

### Step 1: Verify on Calendar Page

- **Action**: Verify
- **Target**: URL contains "/app/calendar"

**VERIFIED PLAYWRIGHT CODE**:
```python
if "/app/calendar" not in page.url:
    calendar_menu = page.get_by_text("Calendar", exact=True)
    calendar_menu.click()
    page.wait_for_url("**/app/calendar**", timeout=10000)
```

### Step 2: Wait for Calendar to Load

- **Action**: Wait
- **Target**: Calendar iframe and New button

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_selector('iframe[title="angularjs"]', timeout=10000)
outer_iframe = page.frame_locator('iframe[title="angularjs"]')
inner_iframe = outer_iframe.frame_locator('#vue_iframe_layout')
new_btn = inner_iframe.get_by_role('button', name='New')
new_btn.wait_for(state='visible', timeout=10000)
```

### Step 3: Click New Button

- **Action**: Click
- **Target**: "New" button in calendar header

**VERIFIED PLAYWRIGHT CODE**:
```python
new_btn.click()
page.wait_for_timeout(500)  # Wait for dropdown menu
```

### Step 4: Select Appointment from Menu

- **Action**: Click
- **Target**: "Appointment" menu item

**VERIFIED PLAYWRIGHT CODE**:
```python
# CRITICAL: Use exact=True to avoid matching calendar items
appointment_option = inner_iframe.get_by_role('menuitem', name='Appointment', exact=True)
appointment_option.wait_for(state='visible', timeout=5000)
appointment_option.click()
# Wait for client selection dialog
dialog = outer_iframe.get_by_role('dialog')
dialog.wait_for(state='visible', timeout=10000)
```

### Step 5: Search for Test Client

- **Action**: Type
- **Target**: Client search field

**VERIFIED PLAYWRIGHT CODE**:
```python
search_field = outer_iframe.get_by_role('textbox', name='Search by name, email or tag')
search_field.click()
page.wait_for_timeout(100)
search_field.press_sequentially(client_name, delay=30)
page.wait_for_timeout(500)  # Allow search results to update
```

### Step 6: Select the Client

- **Action**: Click
- **Target**: Client in search results

**VERIFIED PLAYWRIGHT CODE**:
```python
client_option = outer_iframe.get_by_role('button').filter(has_text=client_name)
client_option.wait_for(state='visible', timeout=5000)
client_option.click()
page.wait_for_timeout(1000)  # Wait for service panel to load
```

### Step 7: Click Custom Service Button

- **Action**: Click
- **Target**: "Custom service" button

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `inner_iframe.get_by_role('button', name='Custom service')` | Semantic, unique | None |

**CHOSEN**: `inner_iframe.get_by_role('button', name='Custom service')` - Verified working in MCP.

**VERIFIED PLAYWRIGHT CODE**:
```python
# Click "Custom service" button to create a custom meeting without predefined service
custom_service_btn = inner_iframe.get_by_role('button', name='Custom service')
custom_service_btn.wait_for(state='visible', timeout=5000)
custom_service_btn.click()
page.wait_for_timeout(1000)  # Wait for custom service form to load
```

### Step 8: Enter Custom Meeting Title

- **Action**: Fill
- **Target**: "Appointment title" textbox

**VERIFIED PLAYWRIGHT CODE**:
```python
title_field = inner_iframe.get_by_role('textbox', name='Appointment title')
title_field.wait_for(state='visible', timeout=5000)
title_field.fill(custom_title)
```

### Step 9: Select Location

- **Action**: Click
- **Target**: Location dropdown and "My business address" option

**VERIFIED PLAYWRIGHT CODE**:
```python
# Click to expand location dropdown - use a filter to find the dropdown with arrow
location_dropdown = inner_iframe.get_by_role('button').filter(has_text='arrow_drop_down').first
location_dropdown.click()
page.wait_for_timeout(500)  # Wait for dropdown to open

# Select "My business address"
my_business_option = inner_iframe.get_by_role('option', name='My business address')
my_business_option.wait_for(state='visible', timeout=5000)
my_business_option.click()
page.wait_for_timeout(500)  # Wait for selection to apply
```

### Step 10: Click Schedule Appointment

- **Action**: Click
- **Target**: "Schedule appointment" button

**VERIFIED PLAYWRIGHT CODE**:
```python
schedule_btn = inner_iframe.get_by_role('button', name='Schedule appointment')
schedule_btn.wait_for(state='visible', timeout=5000)
schedule_btn.click()
```

### Step 11: Verify Appointment in Calendar (Actual Data Verification)

- **Action**: Verify
- **Target**: Appointment appears in calendar with custom title and client name

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_timeout(3000)  # Allow calendar to refresh

# The custom appointment appears as a menuitem containing both client name and custom title
appointment_in_calendar = inner_iframe.get_by_role('menuitem').filter(has_text=custom_title)
appointment_in_calendar.wait_for(state='visible', timeout=15000)
```

## Success Verification

- Custom appointment appears in calendar with the custom title (actual data verification)
- Appointment shows the client name
- DO NOT rely on toast messages
