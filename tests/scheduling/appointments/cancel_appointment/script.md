# Cancel Appointment Test - Detailed Script

> **Status**: Generated from MCP exploration
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI exploration with Playwright MCP

## Initial State

- User is logged in
- An appointment exists (from create_appointment test)
- Context has: created_appointment_client, created_appointment_service
- Browser is on Calendar page

## Actions

### Step 1: Verify on Calendar Page

- **Action**: Verify
- **Target**: URL contains "/app/calendar"

**VERIFIED PLAYWRIGHT CODE**:
```python
if "/app/calendar" not in page.url:
    calendar_menu = page.get_by_text("Calendar", exact=True)
    calendar_menu.click()
    page.wait_for_url("**/app/calendar**", timeout=10000)
```

### Step 2: Wait for Calendar to Load

- **Action**: Wait
- **Target**: Calendar iframe and appointments

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_selector('iframe[title="angularjs"]', timeout=10000)
outer_iframe = page.frame_locator('iframe[title="angularjs"]')
inner_iframe = outer_iframe.frame_locator('#vue_iframe_layout')
page.wait_for_timeout(2000)  # Wait for calendar to load
```

### Step 3: Click on Appointment in Calendar

- **Action**: Click
- **Target**: Appointment menuitem with client name

**VERIFIED PLAYWRIGHT CODE**:
```python
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
appointment.click()
```

### Step 4: Wait for Appointment Details Page

- **Action**: Wait
- **Target**: Appointment details page loads

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_url("**/app/appointments/**", timeout=10000)
heading = outer_iframe.get_by_role('heading', name='Appointment').first
heading.wait_for(state='visible', timeout=10000)
```

### Step 5: Click Cancel Appointment Button

- **Action**: Click
- **Target**: "Cancel Appointment" button

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `outer_iframe.get_by_role('button', name='Cancel Appointment')` | Semantic, unique | None |

**CHOSEN**: `outer_iframe.get_by_role('button', name='Cancel Appointment')` - Verified working in MCP.

**VERIFIED PLAYWRIGHT CODE**:
```python
cancel_btn = outer_iframe.get_by_role('button', name='Cancel Appointment')
cancel_btn.wait_for(state='visible', timeout=5000)
cancel_btn.click()
page.wait_for_timeout(1000)  # Wait for dialog to open
```

### Step 6: Wait for Cancel Dialog

- **Action**: Wait
- **Target**: Cancel confirmation dialog

**VERIFIED PLAYWRIGHT CODE**:
```python
dialog = outer_iframe.get_by_role('dialog')
dialog.wait_for(state='visible', timeout=10000)
```

### Step 7: Click Submit Button

- **Action**: Click
- **Target**: "Submit" button in dialog

**VERIFIED PLAYWRIGHT CODE**:
```python
submit_btn = outer_iframe.get_by_role('button', name='Submit')
submit_btn.click()
page.wait_for_timeout(2000)  # Wait for cancellation to complete
```

### Step 8: Verify Appointment is Cancelled (Actual Data Verification)

- **Action**: Verify
- **Target**: Status shows "Cancelled"

**VERIFIED PLAYWRIGHT CODE**:
```python
# Verify the status changed to "Cancelled" (actual data verification)
cancelled_status = outer_iframe.get_by_text('Cancelled', exact=True)
cancelled_status.wait_for(state='visible', timeout=10000)
```

### Step 9: Return to Calendar

- **Action**: Click
- **Target**: "Back" link

**VERIFIED PLAYWRIGHT CODE**:
```python
back_btn = page.get_by_text('Back')
back_btn.click()
page.wait_for_url("**/app/calendar**", timeout=10000)
```

## Success Verification

- Status shows "Cancelled" in appointment details (actual data verification)
- Activity log shows "Appointment cancelled"
- DO NOT rely on toast messages
