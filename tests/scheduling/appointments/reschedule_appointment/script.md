# Reschedule Appointment Test - Detailed Script

> **Status**: Generated from MCP exploration
> **Last Updated**: 2026-01-23
> **Generated By**: Cursor AI exploration with Playwright MCP

## Initial State

- User is logged in
- An appointment exists (from create_appointment test)
- Context has: created_appointment_client, created_appointment_service
- Browser is on Calendar page

## Actions

### Step 1: Verify on Calendar Page

- **Action**: Verify
- **Target**: URL contains "/app/calendar"

**VERIFIED PLAYWRIGHT CODE**:
```python
if "/app/calendar" not in page.url:
    calendar_menu = page.get_by_text("Calendar", exact=True)
    calendar_menu.click()
    page.wait_for_url("**/app/calendar**", timeout=10000)
```

### Step 2: Wait for Calendar to Load

- **Action**: Wait
- **Target**: Calendar iframe and appointments

**VERIFIED PLAYWRIGHT CODE**:
```python
client_name = context.get("created_appointment_client")
page.wait_for_selector('iframe[title="angularjs"]', timeout=10000)
outer_iframe = page.frame_locator('iframe[title="angularjs"]')
inner_iframe = outer_iframe.frame_locator('#vue_iframe_layout')
# Wait for calendar to load (event-based: appointment visible)
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
```

### Step 3: Click on Appointment in Calendar

- **Action**: Click
- **Target**: Appointment menuitem with client name

**VERIFIED PLAYWRIGHT CODE**:
```python
appointment = inner_iframe.get_by_role('menuitem').filter(has_text=client_name)
appointment.wait_for(state='visible', timeout=10000)
appointment.click()
```

### Step 4: Wait for Appointment Details Page

- **Action**: Wait
- **Target**: Appointment details page loads

**VERIFIED PLAYWRIGHT CODE**:
```python
page.wait_for_url("**/app/appointments/**", timeout=10000)
heading = outer_iframe.get_by_role('heading', name='Appointment').first
heading.wait_for(state='visible', timeout=10000)
```

### Step 5: Get Current Time from Heading

- **Action**: Read
- **Target**: h2 heading with current date/time

**VERIFIED PLAYWRIGHT CODE**:
```python
# Get the current time displayed (for verification later)
time_heading = outer_iframe.get_by_role('heading', level=2).first
time_heading.wait_for(state='visible', timeout=5000)
original_time = time_heading.text_content()
```

### Step 6: Click Reschedule Button

- **Action**: Click
- **Target**: "Reschedule" button

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `outer_iframe.get_by_role('button', name='Reschedule').first` | Unique, semantic | Multiple may exist in activity log |

**CHOSEN**: `outer_iframe.get_by_role('button', name='Reschedule').first` - Get first instance.

**VERIFIED PLAYWRIGHT CODE**:
```python
reschedule_btn = outer_iframe.get_by_role('button', name='Reschedule').first
reschedule_btn.wait_for(state='visible', timeout=5000)
reschedule_btn.click()
# Wait for dialog (event-based)
dialog = outer_iframe.get_by_role('dialog')
dialog.wait_for(state='visible', timeout=10000)
```

### Step 7: Wait for Reschedule Dialog

- **Action**: Wait
- **Target**: Dialog with time selection

**VERIFIED PLAYWRIGHT CODE**:
```python
dialog = outer_iframe.get_by_role('dialog')
dialog.wait_for(state='visible', timeout=10000)
```

### Step 8: Open Start Time Dropdown

- **Action**: Click
- **Target**: "select" button next to Start Time combobox

**VERIFIED PLAYWRIGHT CODE**:
```python
# Click on the select button to open the time dropdown
# The second "select" button is for the time dropdown (first is for date)
outer_iframe.get_by_role('button', name='select').nth(1).click()
# Wait for dropdown to open (event-based: time option visible)
new_time_option = outer_iframe.get_by_text('10:00am', exact=True)
new_time_option.wait_for(state='visible', timeout=10000)
```

### Step 9: Select New Time

- **Action**: Click
- **Target**: Time option in dropdown

**LOCATOR DECISION:**

| Option | Pros | Cons |
|--------|------|------|
| `outer_iframe.get_by_text('10:00am', exact=True)` | Exact match, works | None |
| `outer_iframe.get_by_role('option', name='10:00am')` | Semantic | May not work in some browsers |

**CHOSEN**: `outer_iframe.get_by_text('10:00am', exact=True)` - Verified working in MCP.

**VERIFIED PLAYWRIGHT CODE**:
```python
# The dropdown contains option elements with time text like "8:00pm", "10:00am", etc.
# Select a time that's different from current appointment time (locator already waited in Step 8)
new_time_option = outer_iframe.get_by_text('10:00am', exact=True)
new_time_option.click()
page.wait_for_timeout(300)  # Brief settle after selection (allowed)
```

### Step 10: Click Submit Button

- **Action**: Click
- **Target**: "Submit" button in dialog

**VERIFIED PLAYWRIGHT CODE**:
```python
submit_btn = outer_iframe.get_by_role('button', name='Submit')
submit_btn.click()
# Wait for reschedule to complete (event-based: new time visible in heading)
time_heading = outer_iframe.get_by_role('heading', level=2).first
time_heading.wait_for(state='visible', timeout=15000)
```

### Step 11: Verify Time Changed (Actual Data Verification)

- **Action**: Verify
- **Target**: New time displayed in appointment details

**VERIFIED PLAYWRIGHT CODE**:
```python
# Verify the time has changed by checking the h2 heading contains new time
time_heading = outer_iframe.get_by_role('heading', level=2).first
time_heading.wait_for(state='visible', timeout=10000)
new_time = time_heading.text_content()

# Also verify "Rescheduled from" section appears
rescheduled_from = outer_iframe.get_by_text('Rescheduled from')
rescheduled_from.wait_for(state='visible', timeout=5000)
```

### Step 12: Return to Calendar

- **Action**: Click
- **Target**: "Back" link

**VERIFIED PLAYWRIGHT CODE**:
```python
back_btn = page.get_by_text('Back')
back_btn.click()
page.wait_for_url("**/app/calendar**", timeout=10000)
```

## Success Verification

- Time displayed in appointment details has changed (actual data verification)
- "Rescheduled from" section appears with original time
- DO NOT rely on toast messages
