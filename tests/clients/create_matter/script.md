# Create Matter via Quick Actions - Detailed Script

> **Status**: Verified with Playwright MCP
> **Last Updated**: 2026-01-22
> **Generated By**: Cursor AI exploration with Playwright MCP
> **Note**: "Matter" is vcita's general entity - called "Property" for Home Services, "Patient" for Healthcare, etc.

## Parameters
- None (uses randomly generated test data)

## Initial State
- User must be logged in
- URL: https://app.vcita.com/app/dashboard

## Test Data Generation
```python
import time
import random

timestamp = int(time.time())
first_name = random.choice(["Test", "John", "Jane", "Alex", "Sam"])
last_name = f"Property{timestamp}"
email = f"test_{timestamp}@vcita-test.com"
phone = f"1-555-{random.randint(1000000, 9999999)}"
contact_address = f"{random.randint(100, 999)} Test Street, Test City, TC {random.randint(10000, 99999)}"
property_address = f"{random.randint(100, 999)} Property Lane, Property Town, PT {random.randint(10000, 99999)}"
property_type = random.choice(["Residential", "Commercial"])
help_request = "Looking for regular lawn maintenance and landscaping services"
special_instructions = f"Please call before arriving. Gate code: {random.randint(1000, 9999)}"
private_notes = f"VIP customer - Test automation record. Created: {timestamp}"
referred_by = random.choice(["Google Search", "Facebook", "Friend Referral", "Website"])
```

## Actions

### Step 1: Click "Add property" in Quick actions panel
- **Action**: Click
- **Target**: "Add property" in the Quick actions panel on the right side of the dashboard
- **Element hints**:
  - `get_by_text("Add property", exact=True)` - The element is a div with class `VcSmallQuickAction--title`
  - Located in the "Quick actions" panel on the right side of the dashboard
  - NOT a link or button - use text selector
- **Wait for**: Property creation form/dialog to appear (inside iframe)
- **Note**: HEALED 2026-01-22 - UI changed. The Quick Actions button in the sidebar no longer opens a dropdown menu. "Add property" is now directly visible in a static Quick actions panel on the right side.

### Step 2: Click "Show more" to expand contact fields
- **Action**: Click
- **Target**: "Show more" button in the form
- **Element hints**:
  - `get_by_role("button", name="Show more")`
  - Located below the main contact fields
- **Wait for**: Additional fields to appear (Referred by, Social media, etc.)

### Step 3: Fill First Name (Required)
- **Action**: Click then Type Slowly
- **Target**: First Name input field
- **Element hints**:
  - `get_by_role("textbox", name="First Name *")`
  - Inside iframe with title "angularjs"
- **Value**: {first_name}
- **Pattern**: `field.click()` → `wait(100)` → `field.press_sequentially(value)`

### Step 4: Fill Last Name
- **Action**: Click then Type Slowly
- **Target**: Last Name input field
- **Element hints**:
  - `get_by_role("textbox", name="Last Name")`
- **Value**: {last_name}
- **Pattern**: `field.click()` → `wait(100)` → `field.press_sequentially(value)`

### Step 5: Fill Email
- **Action**: Click then Type Slowly
- **Target**: Email input field (autocomplete combobox)
- **Element hints**:
  - Click: `get_by_role("textbox", name="Email")` (transforms to combobox on click)
  - Type: `get_by_role("combobox", name="Email").press_sequentially()`
- **Value**: {email}
- **IMPORTANT**: This field is an autocomplete combobox. Using `.fill()` does NOT work.
  Must click first, then use `.press_sequentially()` to type character by character.

### Step 6: Fill Mobile Phone
- **Action**: Click then Type Slowly
- **Target**: Mobile phone input field (autocomplete combobox)
- **Element hints**:
  - Click: `get_by_role("textbox", name="Mobile phone")` (transforms to combobox on click)
  - Type: `get_by_role("combobox", name="Mobile phone").press_sequentially()`
- **Value**: {phone}
- **IMPORTANT**: Same as Email - must click first, then type slowly with `.press_sequentially()`.

### Step 7: Fill Address
- **Action**: Type
- **Target**: Address input field (contact address)
- **Element hints**:
  - `get_by_role("textbox", name="Address", exact=True)`
- **Value**: {contact_address}

### Step 8: Fill Referred By
- **Action**: Type
- **Target**: Referred by input field
- **Element hints**:
  - `get_by_role("textbox", name="Referred by")`
- **Value**: {referred_by}

### Step 9: Fill Property Address
- **Action**: Type
- **Target**: Property address input field
- **Element hints**:
  - `get_by_role("textbox", name="Property address")`
- **Value**: {property_address}

### Step 10: Select Property Type
- **Action**: Click dropdown, then click option
- **Target**: Property type dropdown
- **Element hints**:
  - `get_by_role("listbox", name="Property type")` to open
  - `get_by_role("option", name="Residential")` to select
- **Value**: {property_type}

### Step 11: Fill Help Request
- **Action**: Type
- **Target**: "How can we help you?" input field
- **Element hints**:
  - `get_by_role("textbox", name="How can we help you?")`
- **Value**: {help_request}

### Step 12: Fill Special Instructions
- **Action**: Type
- **Target**: Special instructions input field
- **Element hints**:
  - `get_by_role("textbox", name="Special instructions/requests")`
- **Value**: {special_instructions}

### Step 13: Fill Private Notes
- **Action**: Type
- **Target**: Private notes input field
- **Element hints**:
  - `get_by_role("textbox", name="Private notes")`
- **Value**: {private_notes}

### Step 14: Click Save Button
- **Action**: Click
- **Target**: Save button
- **Element hints**:
  - `get_by_role("button", name="Save")`
- **Wait for**: Form to close and property card to appear

## Success Verification

### Verify URL
- URL should contain `/app/clients/` followed by client ID
- Extract client ID from URL for context

### Verify Page Title
- Page title should contain property name: "Property / {first_name} {last_name}"

### Verify Contact Information (visible on card)
- Name: "{first_name} {last_name}" should be visible
- Address: "{contact_address}" should be visible
- Referred by: "{referred_by}" should be visible
- Status: "Existing customer" should be visible

### Verify via Edit Dialog (optional deep verification)
- Click edit button next to name
- Verify Email field contains {email}
- Verify Phone field contains {phone}
- Click Cancel to close

## Context Operations
After successful creation:
```python
import re

# Extract client ID from URL
url = page.url
client_id_match = re.search(r'/app/clients/([^/]+)', url)
client_id = client_id_match.group(1) if client_id_match else None

context["created_client_name"] = f"{first_name} {last_name}"
context["created_client_email"] = email
context["created_client_id"] = client_id
```

## Iframe Handling Notes
The form is inside an iframe with title="angularjs". Playwright MCP handles this automatically with:
```python
page.locator('iframe[title="angularjs"]').contentFrame().get_by_role(...)
```

## Notes
- This account uses "Properties" instead of "Clients" (Home Services vertical)
- **UI CHANGE (2026-01-22)**: "Add property" is now in a static Quick actions panel on the right side of the dashboard, not in a dropdown menu from the Quick Actions button
- Must click "Show more" to access Referred by, Social media fields
- Property type dropdown options: "Residential", "Commercial"
- Status dropdown options: "Existing customer", "Lead", etc.
- Form validation requires First Name (marked with *)
