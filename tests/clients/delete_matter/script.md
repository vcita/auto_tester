# Delete Matter - Detailed Script

> **Status**: Verified with Playwright MCP exploration
> **Last Updated**: 2026-01-21
> **Generated By**: Cursor AI exploration with Playwright MCP
> **Note**: "Matter" is vcita's general entity - called "Property" for Home Services, "Patient" for Healthcare, etc.

## Parameters
- Uses `created_matter_name` from context (set by create_matter test)

## Initial State
- User must be logged in
- URL: https://app.vcita.com/app/dashboard
- Context must contain `created_matter_name` from create_matter test

## Actions

### Part 1: Navigate to Clients/Properties List

#### Step 1: Click Properties/Clients in Sidebar
- **Action**: Click on "Properties" navigation item in sidebar
- **Locator**: `page.locator('.menu-items-group > div:nth-child(4)')` or `page.get_by_text("Properties")`
- **Wait for**: URL to contain `/app/clients`
- **Wait for**: Table to load with client rows

### Part 2: Find and Select the Matter

#### Step 2: Search for the Matter (so it appears on first page)
- **Action**: Fill the list search box with the matter name so the table filters and the target row is visible (list has pagination; without search the matter may be on another page).
- **Locator**: `page.get_by_role("searchbox", name="Search by name, email, or phone number")`
- **Action**: `searchbox.fill(matter_name)` then wait for the matter row to be visible.
- **Wait for**: Matter row to appear (ensures search has been applied and row is in DOM).

#### Step 3: Locate the Matter in the List
- **Action**: Find the row containing the matter name from context
- **Locator**: `page.get_by_role("row", name=context["created_matter_name"])`
- **Expected**: Row should be visible in the table (after search)

#### Step 4: Select the Matter Checkbox
- **Action**: Click the checkbox button in the matter's row
- **Locator**: `page.get_by_role("row", name=context["created_matter_name"]).get_by_role("button").first`
- **Note**: The checkbox is wrapped in a button element due to UI framework
- **Wait for**: Selection indicator to show "1 SELECTED OF X [ENTITY]" (ENTITY varies by vertical: PROPERTIES, CLIENTS, PATIENTS, etc.)
- **Expected**: Bulk action buttons appear (Invite via Email, Message, Add tags, Change status, More)

### Part 3: Delete the Matter

#### Step 5: Click the More Button
- **Action**: Click the "More" button to reveal additional actions
- **Locator**: `page.get_by_role("button", name="More", exact=True)`
- **Wait for**: Dropdown menu to appear
- **Expected**: Menu shows options including "Delete" under "MANAGE" section

#### Step 6: Click Delete Option
- **Action**: Click "Delete" from the dropdown menu
- **Locator**: `page.locator('div').filter(hasText=re.compile(r"^Delete$")).nth(1)` or `page.get_by_text("Delete", exact=True)`
- **Wait for**: Confirmation dialog to appear
- **Expected**: Dialog with title "Delete <entity>?" (entity varies: properties, clients, patients, students, pets, etc.). Use `get_by_text(re.compile(r"Delete .+\?", re.IGNORECASE))` to be entity-agnostic.

#### Step 7: Confirm Deletion
- **Action**: Click "Delete" button in confirmation dialog
- **Locator**: `page.get_by_role("button", name="Delete")`
- **Note**: This is the second "Delete" button (in the dialog, not the menu)
- **Wait for**: Success dialog to appear

#### Step 8: Acknowledge Success Dialog
- **Action**: Click "OK" button in success dialog
- **Dialog title**: "<Entity> deleted" (e.g. "Properties deleted", "Clients deleted"). Use `get_by_text(re.compile(r".+ deleted", re.IGNORECASE))` to be entity-agnostic.
- **Dialog message**: Message about list update (wording varies by vertical)
- **Locator**: `page.get_by_role("button", name="OK")`
- **Wait for**: Dialog to close, table to refresh

### Part 4: Verify Deletion (USER PERSPECTIVE)

#### Step 9: Verify Matter is ACTUALLY Removed from List
- **Action**: Verify the matter no longer appears in the list
- **Locator**: `page.get_by_role("row", name=context["created_matter_name"])`
- **Expected**: Row should NOT be visible (count should be 0)
- **CRITICAL**: This is the real validation - seeing the item is gone, not just a toast

#### Step 10: Verify Table Count Decreased
- **Action**: Verify the properties count decreased
- **Locator**: `page.get_by_text(re.compile(r"\d+ PROPERTIES"))`
- **Expected**: Count should be one less than before deletion

#### Step 11: Clear Context
- **Action**: Remove matter data from context
- **Clear**: `created_matter_name`, `created_matter_email`, `created_matter_id`

## Success Verification (USER PERSPECTIVE)
- **Primary**: Matter row no longer visible in the clients table
- **Secondary**: Table count decreased by 1 (e.g., "3 PROPERTIES" → "2 PROPERTIES")
- **Secondary**: Tab count updated (e.g., "All 3" → "All 2")
- **NOT sufficient alone**: Success dialog or toast message

## Error Conditions
- Matter not found in list → Test should fail with clear message
- Delete button not available → May indicate permission issue
- Confirmation dialog doesn't appear → UI change or error

## UI Notes (From Complete Exploration)
- Sidebar shows "Properties" (Home Services vertical terminology)
- Checkbox is wrapped in a button element (click the button, not the checkbox directly)
- After selecting, bulk action buttons appear above the table
- "More" button contains: Remove tags, Merge, Delete (under MANAGE), Share document, Internal document (under ENGAGE)
- **Confirmation dialog**: "Delete <entity>?" (entity varies by vertical). Success dialog: "<Entity> deleted". Use regex for entity-agnostic tests.
- After clicking OK, the row is immediately removed from the table
- Table count updates automatically (label varies: PROPERTIES, CLIENTS, PATIENTS, etc.)
- Tab count updates automatically (e.g., "All 3" → "All 2")

## Locator Summary
| Element | Role/Locator |
|---------|-------------|
| Properties nav | `.menu-items-group > div:nth-child(4)` |
| Search box | `get_by_role("searchbox", name="Search by name, email, or phone number")` |
| Matter row | `get_by_role("row", name="...")` (use after search so row is on first page) |
| Row checkbox | Row's first button element |
| More button | `get_by_role("button", name="More", exact=True)` |
| Delete menu item | `locator('div').filter(hasText=r"^Delete$")` |
| Confirm Delete | `get_by_role("button", name="Delete")` |
| Success OK | `get_by_role("button", name="OK")` |
